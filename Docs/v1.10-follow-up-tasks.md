# v1.10 Follow-up Tasks

Post-release items identified during v1.10 review that require more extensive changes.

## High Priority

### 1. Performance Gate Real-time Checks

**Issue**: Current perf gates only check aggregate metrics at end of 60s run. Short spikes (e.g., 5s burst of resume failures) won't fail the gate even if they violate SLO.

**Impact**: Regressions in resume reliability or buffer pressure could slip through CI if they're transient.

**Proposed Fix**:
- Add interval-based gate checking (every 10s)
- Fail fast if any 10s window shows:
  - Resume success < 95% (stricter than 98% aggregate)
  - Buffer trim rate > 1% in window
  - Any single resume attempt > 15s
- Export time-series metrics to artifact for post-analysis

**Files**:
- `perf/sse-live-resume.mjs` - Add windowed metrics
- `.github/workflows/perf-gate.yml` - Add time-series artifact upload

**Estimate**: 4-6 hours

---

### 2. Chaos Test Telemetry Assertions

**Issue**: Disconnect and Redis blip chaos tests validate behavior but don't verify telemetry events fire or state cleanup occurs. Regressions in observability won't be caught.

**Impact**: Runbooks depend on telemetry (`SseResumeLiveEnd`, `SseBufferTrimmed`) but tests don't validate it.

**Proposed Fix**:
- Add in-memory telemetry sink to chaos tests
- Assert expected telemetry events fire:
  - `SseResumeAttempt` on disconnect
  - `SseBufferTrimmed` when buffer full
  - `SseResumeLiveEnd` on completion
- Verify Redis key cleanup:
  - `sse:state:*` removed after stream ends
  - `sse:buffer:*` expired after TTL

**Files**:
- `tests/chaos/disconnect.test.ts` - Add telemetry assertions
- `tests/chaos/redis-blip.test.ts` - Add state cleanup checks
- `tests/utils/telemetry-sink.ts` - New: In-memory event collector

**Estimate**: 6-8 hours

---

## Medium Priority

### 3. Priority Metadata Optimization

**Issue**: Priority-based trimming scans all buffered events (O(n)) and decompresses them on every overflow. Acceptable at 256 events but doesn't scale.

**Impact**: At higher buffer limits (512+ events), eviction latency could spike.

**Proposed Fix**:
- Store lightweight metadata alongside each event:
  ```typescript
  sse:meta:{request_id} = [
    { seq: 1, priority: 3, size_bytes: 1024 },
    { seq: 2, priority: 0, size_bytes: 512 },
    ...
  ]
  ```
- Use metadata for O(1) eviction decisions
- Only decompress event being trimmed

**Files**:
- `src/utils/sse-state.ts` - Refactor buffering to store metadata
- Migration strategy for existing buffers

**Estimate**: 12-16 hours (includes migration testing)

**Defer to**: v1.11 or later (not blocking for current scale)

---

### 4. Performance Dashboard

**Issue**: No centralized view of perf-gate trends over time. Hard to spot degradation patterns.

**Proposed Fix**:
- GitHub Actions workflow to collect perf-gate results
- Generate trend charts (p95 latency, resume success rate, trim rate)
- Upload to GitHub Pages or external dashboard

**Files**:
- `.github/workflows/perf-dashboard.yml` - Collect and visualize
- `scripts/generate-perf-dashboard.mjs` - Chart generation

**Estimate**: 8-10 hours

**Defer to**: Post-v1.10 (nice-to-have)

---

## Notes

- Item #1 and #2 should be prioritized if releasing v1.10 to production with high traffic
- Item #3 can wait until buffer limits are increased beyond defaults
- Item #4 is developer experience improvement, not blocking

**Next Review**: After implementing #1 and #2, re-evaluate priority of #3 based on production buffer metrics.
